<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luxe Store</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        /* Product modal hover */
        #productImage {
            transition: transform 0.3s;
        }

        #productImage:hover {
            transform: scale(1.05);
        }

        /* Feedback scroll style */
        #customerFeedback::-webkit-scrollbar {
            width: 6px;
        }

        #customerFeedback::-webkit-scrollbar-thumb {
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 3px;
        }

        #customerFeedback .list-group-item:hover {
            background-color: #f1f3f5;
        }

        .cart-image:hover {
            cursor: pointer;
            transform: scale(1.05);
            transition: transform 0.2s;
        }
    </style>
</head>

<body class="bg-light">
    <div class="container my-4">

        <button id="submit-cart" class="btn btn-primary mb-3">Submit Cart</button>

        <!-- Cart Button -->
        <button class="cart-btn btn btn-outline-secondary position-relative rounded-circle m-4" data-bs-toggle="offcanvas"
            data-bs-target="#cartDrawer">
            <i class="bi bi-cart-fill fs-5"></i>
            <span class="cart-count position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span>
        </button>

        <!-- Drawer -->
        <div class="offcanvas offcanvas-end" tabindex="-1" id="cartDrawer">
            <div class="offcanvas-header border-bottom">
                <h5 class="offcanvas-title fw-bold">ðŸ›’ Your Cart: <span class="cart-count"></span></h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
            </div>
            <div class="offcanvas-body bg-light">
                <div id="cart-items-list" class="d-flex flex-column gap-3"></div>
            </div>
            <div class="offcanvas-footer border-top p-3">
                <button class="btn btn-dark w-100">Checkout</button>
            </div>
        </div>

        <!-- Product Modal -->
        <div class="modal fade" id="productModal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content border-0 shadow-lg" style="border-radius: 8px; overflow: hidden;">
                    <!-- Modal Header -->
                    <div class="modal-header bg-dark text-white">
                        <h5 class="modal-title fw-bold" id="productModalLabel">Product Details</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <!-- Modal Body -->
                    <div class="modal-body p-4 bg-light">
                        <div class="row g-4 align-items-start">
                            <!-- Left: Product Image -->
                            <div class="col-md-5 text-center">
                                <img id="productImage" alt="Product Image"
                                    class="img-fluid rounded-2 shadow-sm" style="max-height: 280px; object-fit: cover;">
                            </div>
                            <!-- Right: Product Info -->
                            <div class="col-md-7 d-flex flex-column justify-content-start">
                                <span id="productCategory" class="fw-bold text-primary mb-1" style="font-size: 0.85rem;"></span>
                                <h3 id="productTitle" class="fw-bold text-dark mb-2" style="font-size: 1.5rem;"></h3>
                                <div class="d-flex align-items-center mb-2">
                                    <div id="productRating" class="text-warning fs-5 me-2"></div>
                                    <span id="productRatingValue" class="text-muted small"></span>
                                </div>
                                <div class="mb-3">
                                    <span id="productPrice" class="text-success fw-bold fs-5"></span>
                                    <small class="text-muted text-decoration-line-through ms-2" id="productOldPrice"></small>
                                    <span id="productDiscount" class="ms-2 text-danger fw-semibold"></span>
                                </div>
                                <p id="productDescription" class="text-secondary small mb-3" style="line-height: 1.5;"></p>

                                <!-- Buttons -->
                                <div id="addToCartBtnContainer" class="d-flex gap-2 mb-3">
                                    <button id="addToCartBtn" class="btn flex-fill text-start"
                                        style="background-color: #000; color: #fff; border: none; border-radius: 4px; padding: 0.5rem 1rem; font-size: 0.95rem;">
                                        <i class="bi bi-cart-plus me-2"></i> Add to Cart
                                    </button>
                                    <button class="btn btn-outline-secondary flex-fill text-start" data-bs-dismiss="modal"
                                        style="border-radius: 4px; padding: 0.5rem 1rem; font-size: 0.95rem;">
                                        Close
                                    </button>
                                </div>

                                <!-- Customer Feedback Section -->
                                <div id="customerFeedbackContainer">
                                    <h6 class="fw-bold text-dark mb-2">Customer Feedback</h6>
                                    <div id="customerFeedback" class="list-group" style="max-height: 200px; overflow-y: auto;">
                                        <!-- Reviews dynamically appended here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Cards -->
        <div class="row row-cols-1 row-cols-md-3 g-4 mt-4" id="productList"></div>

    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        const products = [
            {
                "id": 1,
                "img1": "https://rukminim2.flixcart.com/image/612/612/xif0q/shirt/8/1/9/xl-white-chex-shirt-mentific-original-imahc5ha7nyxxmvu.jpeg?q=70",
                "title": "Checked White Shirt",
                "description": "Classic white shirt with modern check pattern.",
                "price": "29.99",
                "oldPrice": "39.99",
                "discount": "25%",
                "category": "Shirts",
                "rating": 4,
                "totalCustomerReviews": 85,
                "customerFeedback": [
                    { "user": "Alice", "comment": "Excellent quality!" },
                    { "user": "Bob", "comment": "Fits perfectly." },
                    { "user": "Charlie", "comment": "Worth the price." }
                ]
            },
            {
                "id": 2,
                "img1": "https://rukminim2.flixcart.com/image/612/612/xif0q/t-shirt/n/0/m/l-polo-8015-kajaru-original-imaherkhrkpnzzjw.jpeg?q=70",
                "title": "Black Cotton T-Shirt",
                "description": "Comfortable everyday black t-shirt in pure cotton.",
                "price": "15.99",
                "oldPrice": "20.99",
                "discount": "24%",
                "category": "T-Shirts",
                "rating": 5,
                "totalCustomerReviews": 120,
                "customerFeedback": [
                    { "user": "Alice", "comment": "Great quality and fit!" },
                    { "user": "Bob", "comment": "Very comfortable for daily wear." }
                ]
            }
        ];

        function renderStars(rating) {
            let stars = "";
            for (let i = 1; i <= 5; i++) {
                stars += i <= rating ? '<i class="bi bi-star-fill"></i>' : '<i class="bi bi-star"></i>';
            }
            return stars;
        }

        function renderFeedback(reviews = []) {
            const $container = $("#customerFeedback");
            $container.empty();
            if (reviews.length === 0) {
                $container.append('<div class="text-muted small">No reviews yet.</div>');
            } else {
                reviews.forEach(r => {
                    const reviewHtml = `
                    <div class="list-group-item p-2 border-0 d-flex align-items-start" style="background-color:#fff; border-bottom:1px solid #e9ecef;">
                        <i class="bi bi-person-circle fs-5 me-2 text-primary"></i>
                        <div>
                            <span class="fw-semibold">${r.user}</span>
                            <p class="mb-0 text-secondary small">${r.comment}</p>
                        </div>
                    </div>`;
                    $container.append(reviewHtml);
                });
            }
        }

        function updateCartCount() {
            const cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];
            $('.cart-count').text(cartItems.length);
        }

        function renderCart() {
            const $cartList = $("#cart-items-list");
            $cartList.empty();
            const items = JSON.parse(localStorage.getItem("cartItems")) || [];
            items.forEach(product => {
                const card = $(`
                <div class="card shadow-sm border-0 rounded-3">
                  <div class="card-body d-flex align-items-center">
                    <img src="${product.img1}" alt="${product.title}" class="cart-image rounded me-3 border" data-id="${product.id}" style="width:60px; height:60px; object-fit:cover;">
                    <div class="flex-grow-1">
                      <h6 class="mb-1 fw-semibold">${product.title}</h6>
                      <p class="text-muted small mb-0">$ ${product.price}</p>
                    </div>
                    <button class="btn btn-sm btn-outline-danger ms-3 remove-item" data-id="${product.id}"><i class="bi bi-trash"></i></button>
                  </div>
                </div>`);
                $cartList.append(card);
            });
            updateCartCount();
        }

        $(document).ready(function () {
            renderCart();

            // Render product cards
            const $productList = $("#productList");
            products.forEach(product => {
                const card = $(`
                <div class="col">
                    <div class="card h-100 shadow-sm border-0">
                        <img src="${product.img1}" class="card-img-top cart-image" data-id="${product.id}" alt="${product.title}" style="cursor:pointer; height:200px; object-fit:cover;">
                        <div class="card-body">
                            <h5 class="card-title">${product.title}</h5>
                            <p class="card-text text-success fw-bold">$${product.price}</p>
                        </div>
                    </div>
                </div>`);
                $productList.append(card);
            });
        });

        // Submit Cart
        $(document).on("click", "#submit-cart", function () {
            localStorage.setItem("cartItems", JSON.stringify(products));
            alert("Cart saved to localStorage âœ…");
            renderCart();
        });

        // Remove from cart with slide animation
        $(document).on("click", ".remove-item", function () {
            const idToRemove = parseInt($(this).data("id"));
            const $card = $(this).closest(".card");

            $card.slideUp(300, function () {
                $card.remove();
                let cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];
                cartItems = cartItems.filter(item => item.id !== idToRemove);
                localStorage.setItem("cartItems", JSON.stringify(cartItems));
                updateCartCount();
            });
        });

        // Open modal
        $(document).on("click", ".cart-image", function () {
            const idProduct = parseInt($(this).data("id"));
            const product = products.find(p => p.id === idProduct);

            if (product) {
                $("#productImage").attr("src", product.img1);
                $("#productTitle").text(product.title);
                $("#productCategory").text(product.category || "Category");
                $("#productDescription").text(product.description);
                $("#productPrice").text("$" + product.price);
                $("#productOldPrice").text(product.oldPrice ? "$" + product.oldPrice : "");
                $("#productDiscount").text(product.discount ? product.discount : "");
                $("#productRating").html(renderStars(product.rating || 4));
                $("#productRatingValue").text("(" + (product.totalCustomerReviews || 0) + " reviews)");
                renderFeedback(product.customerFeedback || []);

                const productInCart = (JSON.parse(localStorage.getItem("cartItems")) || []).some(item => item.id === product.id);
                console.log(productInCart);

                if (productInCart) {
                    $("#addToCartBtnContainer").addClass("d-none"); // hide flex container properly
                } else {
                    $("#addToCartBtnContainer").removeClass("d-none"); // show again
                }

                new bootstrap.Modal(document.getElementById('productModal')).show();
            }
        });

        // Add to cart from modal
        $(document).on("click", "#addToCartBtn", function () {
            const title = $("#productTitle").text();
            const product = products.find(p => p.title === title);
            if (product) {
                let cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];
                cartItems.push(product);
                localStorage.setItem("cartItems", JSON.stringify(cartItems));
                renderCart();
                $("#addToCartBtnContainer").addClass("d-none");
            }
        });
    </script>
</body>

</html>
